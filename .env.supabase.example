# Supabase PostgreSQL 配置示例
# 复制此文件为 .env.supabase 并填入实际值

# =============================================================================
# Supabase 数据库配置
# =============================================================================

# Supabase PostgreSQL 连接字符串
# 格式 1: Session pooler (推荐，适合高并发)
# postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres
DATABASE_URL="postgresql://postgres.xxxxxxxxxxxxx:your-password@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres"

# 格式 2: Direct connection (适合长连接)
# DATABASE_URL="postgresql://postgres:[password]@db.[project-ref].supabase.co:5432/postgres"

# 注意事项：
# 1. 将 xxxxxxxxxxxxx 替换为你的 Supabase 项目 ID
# 2. 将 your-password 替换为你的数据库密码
# 3. 如果密码包含特殊字符，需要 URL 编码：
#    @ → %40, # → %23, & → %26, 空格 → %20
# 4. 选择离你最近的区域：
#    - Singapore: aws-0-ap-southeast-1
#    - Tokyo: aws-0-ap-northeast-1
#    - US East: aws-0-us-east-1
#    - Frankfurt: aws-0-eu-central-1

# 示例（已编码密码）：
# DATABASE_URL="postgresql://postgres.abcdefghijklmno:MyP%40ss%23123@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres"

# =============================================================================
# Supabase 附加功能（可选）
# =============================================================================

# Supabase API URL（如果想使用 Supabase 的其他功能）
SUPABASE_URL="https://xxxxxxxxxxxxx.supabase.co"

# Supabase Anon Key（公开密钥，用于客户端）
SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# Supabase Service Role Key（私密密钥，仅服务端使用）
# ⚠️ 不要暴露在客户端！
SUPABASE_SERVICE_ROLE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# =============================================================================
# 服务器配置
# =============================================================================

NODE_ENV=production
PORT=3001
LOG_LEVEL=info

# 启用查询日志（开发环境）
# LOG_QUERIES=true

# =============================================================================
# AI 服务配置
# =============================================================================

# OpenAI API (或兼容接口)
OPENAI_API_KEY=sk-your_openai_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4-turbo-preview
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# 自定义 AI 提供商（可选）
CUSTOM_PROVIDER_NAME=custom
CUSTOM_API_KEY=your_custom_api_key
CUSTOM_BASE_URL=https://your-api.com/v1
CUSTOM_MODEL=your-model-name
CUSTOM_TEMPERATURE=1
CUSTOM_MAX_TOKENS=4096

# =============================================================================
# 存储配置 - Cloudflare R2
# =============================================================================

CLOUDFLARE_R2_ACCOUNT_ID=your_account_id
CLOUDFLARE_R2_ACCESS_KEY_ID=your_access_key_id
CLOUDFLARE_R2_SECRET_ACCESS_KEY=your_secret_access_key
CLOUDFLARE_R2_BUCKET_NAME=your_bucket_name
CLOUDFLARE_R2_ENDPOINT=https://your_account_id.r2.cloudflarestorage.com

# 可选：R2 公开域名
CLOUDFLARE_R2_PUBLIC_DOMAIN=https://your_account_id.r2.cloudflarestorage.com

# 可选：CDN 域名（加速访问）
CLOUDFLARE_R2_CDN_DOMAIN=cdn.yourdomain.com

# =============================================================================
# 记忆服务配置 - Mem0
# =============================================================================

MEM0_ENABLED=true
MEM0_API_KEY=your_mem0_api_key
MEM0_BASE_URL=https://api.mem0.ai
MEM0_TIMEOUT=5000
MEM0_RETRIES=3
MEM0_FALLBACK_ENABLED=true
MEM0_LOG_LEVEL=info

# =============================================================================
# 前端配置
# =============================================================================

# API 基础URL
VITE_API_BASE_URL=http://localhost:3001

# Clerk 认证（可选）
VITE_CLERK_PUBLISHABLE_KEY=pk_test_your_clerk_key_here

# 认证模式切换（可选）
VITE_ALLOW_AUTH_MODE_SWITCH=true
VITE_ENABLE_SOCIAL_LOGIN=true
VITE_ENABLE_EMAIL_VERIFICATION=true

# =============================================================================
# 安全配置
# =============================================================================

# JWT 密钥（生产环境必须更换）
JWT_SECRET=your_jwt_secret_here_min_32_characters
JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=30d

# 允许的来源（CORS）
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000,https://yourdomain.com

# =============================================================================
# 备份配置（可选）
# =============================================================================

# 数据库备份配置（用于手动备份脚本）
DB_HOST=db.xxxxxxxxxxxxx.supabase.co
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=your_password
DB_NAME=postgres

# 备份设置
BACKUP_PATH=/path/to/backups
BACKUP_RETENTION_DAYS=30
BACKUP_ENCRYPTION_KEY=your_backup_encryption_key_here

# 自动备份（如果配置了定时任务）
AUTO_BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *"  # 每天凌晨2点

# =============================================================================
# 监控和日志（可选）
# =============================================================================

# Sentry 错误追踪（可选）
# SENTRY_DSN=https://your_sentry_dsn

# 性能监控
ENABLE_PERFORMANCE_MONITORING=false

# 缓存配置
CACHE_ENABLED=true
CACHE_TTL=3600

# =============================================================================
# Supabase 特定功能（可选）
# =============================================================================

# 启用 Supabase Realtime（实时数据同步）
ENABLE_SUPABASE_REALTIME=false

# 启用 Supabase Storage（文件存储）
# 如果启用，可以替代 Cloudflare R2
ENABLE_SUPABASE_STORAGE=false

# 启用 Supabase Auth（认证服务）
# 如果启用，可以替代 JWT 或 Clerk
ENABLE_SUPABASE_AUTH=false

# =============================================================================
# 开发工具
# =============================================================================

# Prisma Studio 端口
# PRISMA_STUDIO_PORT=5555

# 开发模式热重载
# WATCH_MODE=true

# =============================================================================
# 快速配置指南
# =============================================================================
#
# 步骤 1: 创建 Supabase 项目
#   访问 https://supabase.com 并创建新项目
#
# 步骤 2: 获取连接字符串
#   Dashboard > Settings > Database > Connection string
#   选择 "Session pooler" 或 "Direct connection"
#
# 步骤 3: 替换上面的 DATABASE_URL
#   将 xxxxxxxxxxxxx 替换为你的项目 ID
#   将 your-password 替换为你的数据库密码
#
# 步骤 4: 应用数据库结构
#   cd server
#   npx prisma generate
#   npx prisma db push
#
# 步骤 5: 测试连接
#   node test-db-connection.js
#
# 步骤 6: 启动应用
#   npm run dev
#
# =============================================================================
